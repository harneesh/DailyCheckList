<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Daily Checklist</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"/>
  <style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      margin: 0;
      padding: 10px;
      background: #f8fafc;
      min-height: 100vh;
      line-height: 1.5;
    }
    
    h2 {
      text-align: center;
      margin: 0 0 20px 0;
      color: #2d3748;
      font-weight: 600;
      font-size: clamp(1.5rem, 5vw, 2rem);
    }
    
    .container {
      max-width: 100%;
      width: 100%;
      max-width: 480px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      border: 1px solid #e2e8f0;
    }
    
    #calendar {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 16px;
      background: #fff;
      margin-bottom: 24px;
      transition: border-color 0.2s ease;
    }
    
    #calendar:focus {
      outline: none;
      border-color: #3182ce;
      box-shadow: 0 0 0 3px rgba(49, 130, 206, 0.1);
    }
    
    .task-list {
      list-style: none;
      padding: 0;
      margin: 0 0 24px 0;
    }
    
    .task-list li {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 0;
      border-bottom: 1px solid #f1f5f9;
      min-height: 60px;
      gap: 12px;
    }
    
    .task-list li:last-child {
      border-bottom: none;
    }
    
    .task-list label {
      flex: 1;
      display: flex;
      align-items: center;
      cursor: pointer;
      gap: 12px;
      font-size: 16px;
      color: #374151;
      font-weight: 500;
    }
    
    .task-list input[type="checkbox"] {
      width: 20px;
      height: 20px;
      border-radius: 6px;
      border: 2px solid #d1d5db;
      background: #fff;
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }
    
    .task-list input[type="checkbox"]:checked {
      background: #10b981;
      border-color: #10b981;
    }
    
    .task-list input[type="checkbox"]:checked + span {
      text-decoration: line-through;
      color: #9ca3af;
    }
    
    .buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 12px;
    }
    
    .buttons button:first-child {
      grid-column: 1 / -1;
    }
    
    button {
      padding: 14px 20px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      transition: all 0.2s ease;
      touch-action: manipulation;
      min-height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    button:active {
      transform: translateY(1px);
    }
    
    #addTaskBtn {
      background: #3182ce;
      color: white;
    }
    
    #addTaskBtn:hover {
      background: #2c5282;
    }
    
    #resetBtn {
      background: #e53e3e;
      color: white;
    }
    
    #resetBtn:hover {
      background: #c53030;
    }
    
    #clearAllBtn {
      background: #718096;
      color: white;
    }
    
    #clearAllBtn:hover {
      background: #4a5568;
    }
    
    .delete-btn {
      background: #fed7d7;
      color: #c53030;
      border: none;
      border-radius: 8px;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s ease;
      flex-shrink: 0;
      font-size: 14px;
    }
    
    .delete-btn:hover {
      background: #feb2b2;
    }

    /* Calendar styling improvements */
    .flatpickr-calendar {
      border-radius: 16px;
      box-shadow: 0 15px 50px rgba(102, 126, 234, 0.25);
      border: 1px solid rgba(102, 126, 234, 0.2);
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
    }
    
    .flatpickr-day {
      border-radius: 10px;
      margin: 1px;
      transition: all 0.2s ease;
    }
    
    .flatpickr-day:hover {
      background: rgba(102, 126, 234, 0.1);
    }

    /* Gradient for all tasks done */
    .flatpickr-day.full-done {
      background: linear-gradient(135deg, #48bb78, #38a169) !important;
      color: #fff !important;
      border-radius: 50% !important;
      box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
    }

    /* Gradient for gym checked */
    .flatpickr-day.gym-done {
      background: linear-gradient(135deg, #667eea, #764ba2) !important;
      color: #fff !important;
      border-radius: 50% !important;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }
    
    /* Mobile optimizations */
    @media (max-width: 480px) {
      body {
        padding: 8px;
      }
      
      .container {
        padding: 16px;
        border-radius: 12px;
      }
      
      h2 {
        font-size: 1.75rem;
        margin-bottom: 16px;
      }
      
      #calendar {
        padding: 10px 14px;
        margin-bottom: 20px;
      }
      
      .task-list li {
        padding: 14px 0;
        min-height: 56px;
      }
      
      .task-list label {
        font-size: 15px;
        gap: 10px;
      }
      
      button {
        padding: 12px 16px;
        font-size: 15px;
        min-height: 44px;
      }
      
      .delete-btn {
        width: 32px;
        height: 32px;
        font-size: 12px;
      }
    }
    
    @media (max-width: 320px) {
      .container {
        padding: 12px;
      }
      
      .buttons {
        gap: 8px;
      }
      
      button {
        padding: 10px 12px;
        font-size: 14px;
        min-height: 40px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>My Daily Checklist</h2>
    <input id="calendar" placeholder="Select Date"/>
    <ul class="task-list" id="taskList"></ul>
    <div class="buttons">
      <button id="addTaskBtn">Add Task</button>
      <button id="resetBtn">Reset This Day</button>
      <button id="clearAllBtn">Clear All Data</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    // ✅ Always get YYYY-MM-DD in local timezone
    function formatDateLocal(dateObj) {
      const y = dateObj.getFullYear();
      const m = String(dateObj.getMonth() + 1).padStart(2, "0");
      const d = String(dateObj.getDate()).padStart(2, "0");
      return `${y}-${m}-${d}`;
    }

    const taskList = document.getElementById("taskList");
    const addTaskBtn = document.getElementById("addTaskBtn");
    const resetBtn = document.getElementById("resetBtn");
    const clearAllBtn = document.getElementById("clearAllBtn");

    let currentDate = formatDateLocal(new Date());

    const TASK_KEYS = ["medicine", "gym", "video_editing", "college_work"];

    function loadTasks(date) {
      taskList.innerHTML = "";
      let saved = localStorage.getItem("tasks_" + date);
      let data = saved ? JSON.parse(saved) : {};

      TASK_KEYS.forEach(task => {
        if (!(task in data)) data[task] = false;
      });

      for (let [task, checked] of Object.entries(data)) {
        createTaskElement(task, checked);
      }
    }

    function createTaskElement(task, checked) {
      const li = document.createElement("li");

      const label = document.createElement("label");

      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.checked = checked;
      checkbox.onchange = () => saveTasks();

      const span = document.createElement("span");
      span.textContent = task.replace(/_/g, " ").replace(/\b\w/g, c => c.toUpperCase());

      label.appendChild(checkbox);
      label.appendChild(span);

      const delBtn = document.createElement("button");
      delBtn.textContent = "✕";
      delBtn.className = "delete-btn";
      delBtn.onclick = () => {
        li.remove();
        saveTasks();
      };

      li.appendChild(label);
      li.appendChild(delBtn);
      taskList.appendChild(li);
    }

    function saveTasks() {
      const data = {};
      taskList.querySelectorAll("li").forEach(li => {
        const text = li.querySelector("span").textContent.toLowerCase().replace(/ /g, "_");
        const checked = li.querySelector("input").checked;
        data[text] = checked;
      });
      localStorage.setItem("tasks_" + currentDate, JSON.stringify(data));
      calendar.redraw();
    }

    addTaskBtn.onclick = () => {
      const name = prompt("Enter task name:");
      if (name) {
        createTaskElement(name.toLowerCase().replace(/ /g, "_"), false);
        saveTasks();
      }
    };

    resetBtn.onclick = () => {
      if (confirm("Reset tasks for this day?")) {
        localStorage.removeItem("tasks_" + currentDate);
        loadTasks(currentDate);
        calendar.redraw();
      }
    };

    clearAllBtn.onclick = () => {
      if (confirm("⚠️ This will clear ALL saved tasks. Continue?")) {
        Object.keys(localStorage).forEach(k => {
          if (k.startsWith("tasks_")) localStorage.removeItem(k);
        });
        loadTasks(currentDate);
        calendar.redraw();
      }
    };

    const calendar = flatpickr("#calendar", {
      defaultDate: new Date(),
      onChange: function(selectedDates) {
        if (selectedDates.length) {
          currentDate = formatDateLocal(selectedDates[0]);
          loadTasks(currentDate);
        }
      },
      onDayCreate: (dObj, dStr, fpInstance, dayElem) => {
        dayElem.classList.remove("full-done", "gym-done");

        const date = formatDateLocal(dayElem.dateObj);
        const saved = localStorage.getItem("tasks_" + date);
        if (!saved) return;

        try {
          const data = JSON.parse(saved);
          const anyChecked = Object.values(data).some(v => v === true);
          if (!anyChecked) return;

          const allComplete = Object.values(data).every(v => v === true);
          if (allComplete) {
            dayElem.classList.add("full-done"); // ✅ green
          } else if (data["gym"] === true) {
            dayElem.classList.add("gym-done"); // ✅ blue
          }
        } catch (e) {}
      }
    });

    loadTasks(currentDate);
  </script>
</body>
</html>